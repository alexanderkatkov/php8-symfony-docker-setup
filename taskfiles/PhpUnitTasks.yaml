version: '3'

tasks:
  prepare:
    desc: "Recreate test DB and migrations"
    cmds:
      - task: :db:remove
        vars: { CLI_ARGS: "test" }
      - task: :db:create
        vars: { CLI_ARGS: "test" }
      - task: :migration:migrate
        vars: { CLI_ARGS: "test" }

  clean-run:
    desc: "Recreate test DB and migrations and run all tests"
    cmds:
      - prepare
      - all

  all:
    desc: "Run all PHPUnit tests"
    cmds:
      - task: :app:exec
        vars: { CLI_ARGS: "bin/phpunit tests --stop-on-failure {{.CLI_ARGS}}" }

  single:
    desc: 'Filter result of single PHPUnit tests: "task phpunit:single -- testName"'
    cmds:
      - task: all
        vars: { CLI_ARGS: "--filter {{.CLI_ARGS}}" }
